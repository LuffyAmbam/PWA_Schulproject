(()=>{var e=null,t=document.getElementById("datepicker"),n=document.getElementById("addLernzielBtn"),o=document.getElementById("dropdownKategorien"),i=window.indexedDB.open("lernApp",1);i.addEventListener("upgradeneeded",(function(e){e.target.result.createObjectStore("Lernziel",{keyPath:"id"})})),i.addEventListener("success",(function(t){console.log("Database geöffnet."),e=t.target.result;var n=function(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.transaction(t,n);return i.addEventListener("error",(function(e){console.error("Transaction error: "+e.target.error)})),i.addEventListener("complete",(function(){console.log("Transaction completed."),"function"==typeof o&&o()})),i.objectStore(t)}("Kategorie","readonly");n.getAll().addEventListener("success",(function(e){e.target.result.forEach((function(e){console.log(e);var t=document.createElement("option");t.setAttribute("data-id",e.kategorieID),t.setAttribute("value",e.kategorieID),t.innerHTML="".concat(e.kategorieName),o.appendChild(t)}))}))})),n.addEventListener("click",(function(){var n=t.value,i=o.options[o.selectedIndex],a=e.transaction("Lernziel","readwrite").objectStore("Lernziel"),r={kategorieID:i.dataset.id,zielDatum:n,gelernteTage:[]};a.put(r),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.active.postMessage({type:"scheduleNotification",date:n})}))})),i.addEventListener("error",(function(e){console.error("Database konnte nicht geöffnet werden."+e.target.error)})),self.addEventListener("message",(function(e){var t,n,o,i,a,r,s;e.data&&"scheduleNotification"===e.data.type&&(t=e.data.date,i=new Date(t),a=new Date,r=i.getTime()-a.getTime(),s=r/864e5,(new Date).setHours(18,0,0),s>0?(n={body:"Don't forget to learn today!",icon:"/path/to/icon.png",badge:"/path/to/badge.png",vibrate:[100,50,100],data:{date:t}},o=r-36e5,"Notification"in window?"granted"===Notification.permission?(console.log("Notification permission already granted."),setTimeout((function(){self.clients.matchAll().then((function(e){e.forEach((function(e){e.postMessage({type:"show-notification",options:n})}))}))}),o)):"denied"!==Notification.permission&&Notification.requestPermission().then((function(e){"granted"===e&&(console.log("Notification permission granted."),setTimeout((function(){self.clients.matchAll().then((function(e){e.forEach((function(e){e.postMessage({type:"show-notification",options:n})}))}))}),o))})):console.error("This browser does not support notifications.")):console.log("The learning goal date has already been reached."))}))})();